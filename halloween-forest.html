<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khu Rừng Halloween</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }

        .bg-animated {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: 0;
            pointer-events: none;
            background: linear-gradient(120deg, #1a0826 0%, #2d1b3d 30%, #3a1852 60%, #4b206b 80%, #1a0826 100%);
            background-size: 200% 200%;
            animation: gradientMove 12s ease-in-out infinite;
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .bg-waves {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: 1;
            pointer-events: none;
            opacity: 0.18;
            mix-blend-mode: lighten;
            animation: wavesMove 18s linear infinite alternate;
        }

        @keyframes wavesMove {
            0% { transform: translateY(0) scaleX(1); }
            100% { transform: translateY(-30px) scaleX(1.03); }
        }

        .forest-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            z-index: 2;
        }

        /* Mặt trăng */
        .moon {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -65%);
            width: 75vw;
            height: 75vw;
            max-width: 75vh;
            max-height: 75vh;
            min-width: 400px;
            min-height: 400px;
            background: radial-gradient(circle at 60% 40%, #fffbe6 70%, #ffe680 100%);
            border-radius: 50%;
            box-shadow: 0 0 120px 40px rgba(255,255,200,0.25), 0 0 200px 80px #fffbe6;
            overflow: hidden;
            z-index: 3;
        }

        .moon-crater {
            position: absolute;
            background: rgba(180, 180, 150, 0.22);
            border-radius: 50%;
            filter: blur(1.5px);
            opacity: 0.7;
        }

        .crater1 { width: 12%; height: 10%; left: 18%; top: 32%; }
        .crater2 { width: 8%; height: 7%; left: 60%; top: 20%; }
        .crater3 { width: 6%; height: 5%; left: 40%; top: 60%; }
        .crater4 { width: 10%; height: 8%; left: 70%; top: 55%; }
        .crater5 { width: 7%; height: 6%; left: 30%; top: 48%; }
        .crater6 { width: 5%; height: 4%; left: 55%; top: 38%; }
        .crater7 { width: 4%; height: 3%; left: 50%; top: 25%; }

        /* Bãi cỏ phía dưới */
        .grass {
            position: absolute;
            left: 0;
            bottom: 0;
            width: 100vw;
            height: 18vh;
            z-index: 4;
            background: #111;
            border-top-left-radius: 60vw 10vh;
            border-top-right-radius: 60vw 10vh;
            box-shadow: 0 -10px 40px 10px #1b2e1d;
            overflow: hidden;
        }

        .witch {
            position: absolute;
            z-index: 5;
            left: 50%;
            top: 40%;
            width: 18vw;
            min-width: 120px;
            max-width: 260px;
            height: auto;
            pointer-events: none;
            filter: drop-shadow(0 4px 12px #0008);
            transform: translate(-50%, -60%);
        }

        .dog {
            position: absolute;
            z-index: 6;
            bottom: 12vh;
            width: 12vw;
            min-width: 80px;
            max-width: 180px;
            height: auto;
            pointer-events: none;
            filter: drop-shadow(0 2px 8px #000a);
            transition: left 7s linear, transform 0.3s;
        }

        .dog-light {
            position: absolute;
            pointer-events: none;
            z-index: 6;
            left: 50%;
            border-radius: 20%;
            bottom: 12vh;
            width: 6vw;
            min-width: 120px;
            max-width: 260px;
            height: 3vw;
            max-height: 300px;
            transform: translate(-50%, 0);
            filter: blur(8px);
            opacity: 0.45;
            background: radial-gradient(ellipse at 50% 80%, #fffbe668 0%, #ffe68063 40%, #ffec806b 60%, #fff0 100%);
            transition: left 7s linear, transform 0.3s;
        }

        .castle {
            position: absolute;
            left: 0;
            bottom: 2vh;
            z-index: 6;
            width: 40vw;
            height: auto;
            pointer-events: none;
            user-select: none;
            opacity: 0;
            transform: translateY(40px) scale(0.95);
            transition: opacity 1.2s cubic-bezier(.4,1,.4,1), transform 1.2s cubic-bezier(.4,1,.4,1);
        }
        .castle.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .tree-right {
            position: absolute;
            top: 0;
            right: 0;
            z-index: 7;
            width: 18vw;
            min-width: 120px;
            max-width: 300px;
            height: auto;
            pointer-events: none;
            user-select: none;
        }

        .ghost-float {
            position: absolute;
            z-index: 8;
            bottom: 24vh;
            width: 6vw;
            min-width: 60px;
            max-width: 120px;
            height: auto;
            pointer-events: none;
            user-select: none;
            transition: left 7s linear, transform 0.3s;
        }

        .eyes-under {
            position: absolute;
            z-index: 11;
            pointer-events: none;
            left: 0;
            bottom: 0;
            width: 100vw;
            height: 18vh;
        }
        .eyes-img {
            position: absolute;
            width: 38px;
            height: auto;
            pointer-events: none;
            user-select: none;
            opacity: 0.92;
            transition: opacity 0.2s;
        }
        .eyes-blink {
            position: absolute;
            display: flex;
            gap: 8px;
            align-items: center;
            opacity: 0.92;
            transition: opacity 0.2s;
        }
        .eye-dot {
            width: 18px;
            height: 12px;
            border-radius: 50% 50% 60% 60%/60% 60% 100% 100%;
            background: radial-gradient(ellipse at 60% 60%, #ff3b3b 70%, #a10000 100%);
            box-shadow: 0 0 8px 2px #ff3b3b, 0 0 18px 6px #a10000;
            position: relative;
            transition: background 0.2s, box-shadow 0.2s;
        }
        .eye-dot::after {
            content: '';
            position: absolute;
            left: 60%;
            top: 35%;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #fff8;
            opacity: 0.7;
            filter: blur(0.5px);
        }
        .eye-dot.closed {
            height: 4px;
            background: #2d1b3d;
            box-shadow: none;
        }

        .pumpkin-group {
            position: absolute;
            right: 2vw;
            bottom: 2vh;
            z-index: 5;
            width: 18vw;
            min-width: 120px;
            max-width: 320px;
            height: auto;
            pointer-events: none;
            user-select: none;
            opacity: 0;
            transform: translateY(40px) scale(0.95);
            transition: opacity 1.2s cubic-bezier(.4,1,.4,1), transform 1.2s cubic-bezier(.4,1,.4,1);
        }
        .pumpkin-group.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .hand-rise {
            position: absolute;
            left: 48vw;
            bottom: 10vh;
            z-index: 5;
            width: 8vw;
            min-width: 60px;
            max-width: 140px;
            height: auto;
            pointer-events: none;
            user-select: none;
            transform: translateY(100%) rotate(0deg) scaleX(1);
            opacity: 0;
            transition: transform 1.2s cubic-bezier(.4,1,.4,1), opacity 0.8s cubic-bezier(.4,1,.4,1);
        }
        .hand-rise.visible {
            transform: translateY(0) rotate(0deg) scaleX(1);
            opacity: 1;
            transition: transform 1.2s cubic-bezier(.4,1,.4,1), opacity 0.8s cubic-bezier(.4,1,.4,1);
        }
        .hand-rotate-left {
            transform: translateY(0) rotate(-25deg) scaleX(-1);
            transition: transform 1s cubic-bezier(.4,1,.4,1);
        }
        .hand-rotate-right {
            transform: translateY(0) rotate(25deg) scaleX(1);
            transition: transform 1s cubic-bezier(.4,1,.4,1);
        }
        .hand-hide {
            transform: translateY(100%) rotate(0deg) scaleX(1);
            opacity: 0;
            transition: transform 1.2s cubic-bezier(.4,1,.4,1), opacity 1.2s cubic-bezier(.4,1,.4,1);
        }
        .hand-shake {
            animation: hand-shake-anim 0.3s ease-in-out infinite;
        }
        @keyframes hand-shake-anim {
            0% { transform: translateY(0) rotate(0deg) scaleX(1) translateX(0); }
            25% { transform: translateY(0) rotate(0deg) scaleX(1) translateX(2px); }
            50% { transform: translateY(0) rotate(0deg) scaleX(1) translateX(-2px); }
            75% { transform: translateY(0) rotate(0deg) scaleX(1) translateX(1px); }
            100% { transform: translateY(0) rotate(0deg) scaleX(1) translateX(0); }
        }
    </style>
</head>
<body>
    <div class="bg-animated"></div>
    <svg class="bg-waves" viewBox="0 0 1920 1080" preserveAspectRatio="none">
        <defs>
            <linearGradient id="waveGrad" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0%" stop-color="#4b206b"/>
                <stop offset="50%" stop-color="#2d1b3d"/>
                <stop offset="100%" stop-color="#1a0826"/>
            </linearGradient>
        </defs>
        <path d="M0,800 Q480,900 960,800 T1920,800 V1080 H0 Z"
              fill="url(#waveGrad)" filter="url(#blur1)"/>
        <path d="M0,850 Q600,950 1200,850 T1920,850 V1080 H0 Z"
              fill="url(#waveGrad)" opacity="0.7"/>
        <filter id="blur1">
            <feGaussianBlur stdDeviation="30"/>
        </filter>
    </svg>
    <div class="forest-container">
        <div class="moon">
            <div class="moon-crater crater1"></div>
            <div class="moon-crater crater2"></div>
            <div class="moon-crater crater3"></div>
            <div class="moon-crater crater4"></div>
            <div class="moon-crater crater5"></div>
            <div class="moon-crater crater6"></div>
            <div class="moon-crater crater7"></div>
        </div>
        <img src="images/castle.png" alt="Lâu đài" class="castle" id="castle" />
        <img src="images/tree-right-1.gif" alt="Cây góc phải" class="tree-right" />
        <img src="images/witch.gif" alt="Phù thủy bay" class="witch" />
        <div class="dog-light" id="dog-light"></div>
        <img src="images/ghost.gif" alt="Ma bay" class="ghost-float" id="ghost1" />
        <div class="grass"></div>
        <img src="images/hand.png" alt="Bàn tay" class="hand-rise" id="hand-rise" />
        <img src="images/pumpkin.gif" alt="Bí ngô" class="pumpkin-group" id="pumpkin-group" />
        <img src="images/dog.gif" alt="Chó chạy" class="dog" id="dog" />
        <div class="eyes-under" id="eyes-under"></div>
    </div>
    <script>
        const dog = document.getElementById('dog');
        const dogLight = document.getElementById('dog-light');
        const ghost1 = document.getElementById('ghost1');
        const forestContainer = document.querySelector('.forest-container');
        const runDuration = 7000; // Thời gian chạy (ms)
        const interval = 10000; // Khoảng thời gian lặp lại (ms)
        const offset = 7; // Khoảng cách giữa con ma và con chó (vw)
        let extraGhosts = [];
        let direction = true; // true: left to right, false: right to left

        function createExtraGhost(id) {
            const ghost = document.createElement('img');
            ghost.src = 'images/ghost.gif';
            ghost.alt = 'Ma bay';
            ghost.className = 'ghost-float';
            ghost.id = id;
            forestContainer.appendChild(ghost);
            return ghost;
        }

        function removeExtraGhosts() {
            extraGhosts.forEach(ghost => ghost.remove());
            extraGhosts = [];
        }

        function runDogAndGhost(nextDirection, delay = 50) {
            removeExtraGhosts();

            if (nextDirection) {
                // Chó đuổi ma (trái sang phải)
                dog.style.left = '-20vw';
                dog.style.transform = 'scaleX(-1)';
                dogLight.style.left = '-14vw';
                dogLight.style.transform = 'translate(-50%, 0) scaleX(-1)';
                ghost1.style.left = `calc(-14vw + ${offset}vw)`;
                ghost1.style.transform = 'translate(-50%, 0) scaleX(-1)';
                void dog.offsetWidth;
                setTimeout(() => {
                    dog.style.left = '110vw';
                    dogLight.style.left = '116vw';
                    ghost1.style.left = `calc(116vw + ${offset}vw)`;
                    // Khi chạy xong, chuyển hướng ngược lại ngay lập tức
                    setTimeout(() => runDogAndGhost(false), runDuration);
                }, delay);
            } else {
                // Ma đuổi chó (phải sang trái) và tạo thêm 2 con ma
                dog.style.left = '110vw';
                dog.style.transform = 'scaleX(1)';
                dogLight.style.left = '116vw';
                dogLight.style.transform = 'translate(-50%, 0) scaleX(1)';
                ghost1.style.left = `calc(116vw + ${offset}vw)`;
                ghost1.style.transform = 'translate(-50%, 0) scaleX(1)';
                const ghost2 = createExtraGhost('ghost2');
                const ghost3 = createExtraGhost('ghost3');
                extraGhosts = [ghost2, ghost3];
                ghost2.style.left = `calc(116vw + ${offset + 2}vw)`;
                ghost2.style.transform = 'translate(-50%, 0) scaleX(1)';
                ghost3.style.left = `calc(116vw + ${offset + 4}vw)`;
                ghost3.style.transform = 'translate(-50%, 0) scaleX(1)';
                void dog.offsetWidth;
                setTimeout(() => {
                    dog.style.left = '-20vw';
                    dogLight.style.left = '-14vw';
                    ghost1.style.left = `calc(-14vw + ${offset}vw)`;
                    ghost2.style.left = `calc(-14vw + ${offset + 2}vw)`;
                    ghost3.style.left = `calc(-14vw + ${offset + 4}vw)`;
                    // Khi chạy xong, đợi 10s rồi mới chạy lại từ trái qua phải
                    setTimeout(() => runDogAndGhost(true), interval);
                }, delay);
            }
        }

        // Khởi tạo vị trí ban đầu (ngoài màn hình bên trái, chó đuổi ma)
        dog.style.left = '-20vw';
        dog.style.transform = 'scaleX(-1)';
        dogLight.style.left = '-14vw';
        dogLight.style.transform = 'translate(-50%, 0) scaleX(-1)';
        ghost1.style.left = `calc(-14vw + ${offset}vw)`;
        ghost1.style.transform = 'translate(-50%, 0) scaleX(-1)';

        // Chạy lần đầu sau 1s
        setTimeout(() => runDogAndGhost(true), 1000);

        // MẮT GIF DƯỚI ĐẤT, TỐI ĐA 3 CẶP, HIỆN 3S RỒI ẨN
        const eyesUnder = document.getElementById('eyes-under');
        const EYES_COUNT = 3;
        const EYES_SHOW_TIME = 3000;
        const EYES_HIDE_TIME = 1200;
        const EYE_GIFS = ['images/eye-1.gif', 'images/eye-2.gif', 'images/eye-3.gif'];

        function randomEyesPosition() {
            // Trả về {left, bottom} (theo %)
            const left = Math.random() * 90 + 5; // %
            const bottom = Math.random() * 10 + 2; // %
            return { left: `${left}%`, bottom: `${bottom}%` };
        }

        function createEyesImg(i) {
            const img = document.createElement('img');
            img.src = EYE_GIFS[i % EYE_GIFS.length];
            img.alt = 'Mắt đỏ';
            img.className = 'eyes-img';
            // Random vị trí
            const pos = randomEyesPosition();
            img.style.left = pos.left;
            img.style.bottom = pos.bottom;
            // Random scale
            const scale = 0.8 + Math.random() * 0.7;
            img.style.transform = `scale(${scale})`;
            return img;
        }

        function showEyesLoop() {
            eyesUnder.innerHTML = '';
            // Random số cặp mắt mỗi lần (1-3)
            const n = 1 + Math.floor(Math.random() * EYES_COUNT);
            // Đảo thứ tự để mắt không trùng nhau mỗi lần
            const shuffled = EYE_GIFS.slice().sort(() => Math.random() - 0.5);
            for (let i = 0; i < n; i++) {
                const eyes = createEyesImg(i);
                eyes.src = shuffled[i % shuffled.length];
                eyesUnder.appendChild(eyes);
            }
            // Ẩn sau 3s rồi hiện lại
            setTimeout(() => {
                eyesUnder.innerHTML = '';
                setTimeout(showEyesLoop, EYES_HIDE_TIME + Math.random() * 1000);
            }, EYES_SHOW_TIME);
        }

        setTimeout(showEyesLoop, 1500);

        // Hiệu ứng bàn tay chồi lên, rung, lật trái/phải, rung, rồi thụt xuống mỗi 5s
        function handRiseLoop() {
            const hand = document.getElementById('hand-rise');
            if (!hand) return;
            // Đưa lên + rung
            hand.classList.add('visible', 'hand-shake');
            hand.classList.remove('hand-rotate-left', 'hand-rotate-right', 'hand-hide');
            // Lật trái + rung
            setTimeout(() => {
                hand.classList.add('hand-rotate-left', 'hand-shake');
                hand.classList.remove('hand-rotate-right', 'hand-hide');
                // Lật phải + rung
                setTimeout(() => {
                    hand.classList.remove('hand-rotate-left');
                    hand.classList.add('hand-rotate-right', 'hand-shake');
                    // Lật trái lại + rung
                    setTimeout(() => {
                        hand.classList.remove('hand-rotate-right');
                        hand.classList.add('hand-rotate-left', 'hand-shake');
                        // Lật phải lại + rung
                        setTimeout(() => {
                            hand.classList.remove('hand-rotate-left');
                            hand.classList.add('hand-rotate-right', 'hand-shake');
                            // Rung trước khi thụt xuống
                            setTimeout(() => {
                                hand.classList.remove('hand-rotate-right', 'visible');
                                hand.classList.add('hand-shake', 'hand-hide');
                                setTimeout(() => {
                                    hand.classList.remove('hand-shake', 'hand-hide');
                                    setTimeout(handRiseLoop, 3000);
                                }, 1200); // thời gian thụt xuống
                            }, 1000); // đứng yên + rung bên phải 1s
                        }, 1000); // lật phải lại + rung 1s
                    }, 1000); // lật trái lại + rung 1s
                }, 1000); // lật phải + rung 1s
            }, 700); // đứng yên + rung sau khi lên
        }

        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                const castle = document.getElementById('castle');
                if (castle) castle.classList.add('visible');
                const pumpkin = document.getElementById('pumpkin-group');
                if (pumpkin) pumpkin.classList.add('visible');
                handRiseLoop();
            }, 400);
        });
    </script>
</body>
</html>